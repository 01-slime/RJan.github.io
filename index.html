<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8" />
        <title>LIFF測試</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                                                              new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                                    })(window,document,'script','dataLayer','GTM-MH9M59N');</script>
        <!-- End Google Tag Manager -->
    </head>
    <body>
        <!-- Google Tag Manager (noscript) -->
        <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MH9M59N"height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
        <!-- End Google Tag Manager (noscript) -->
        <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
        <h1>LIFF測試中</h1>
        <script>
        liff.init({
            liffId: '1657549468-9zdmdydP'
        }).then(() => {
            
            // Start to use liff's api
            // 這邊開始寫使用其他功能
                
            // 使用者是否登入 LINE 帳號
            liff.isLoggedIn();
                
            //gtag設定
            async function configGtag () {
                const config = {
                    app_name: `LIFF ${liff.getOS()}`,       // 回傳使用者作業系統：ios、android、web
                    send_page_view: false,
                    transport_type: 'beacon',
                }
                const profile = await liff.getProfile()     //取得使用者公開資料
                if (profile.userID) config.user_id = profile.userID
                if (liff.isInClient()) config.app_version = liff.getLineVersion()  // 回傳是否由 LINE App 存取 、獲取用戶的 LINE 版本
                gtag('config', 'G-PV0FC44PCR', config)
            }
                
            //送screenview
            function gTagScreenView (screenName) {
                return new Promise(resolve => {
                gTag('event', 'screen_view', {
                    event_callback: resolve,
                    screen_name: screenName,
                    })
                })
            }
                
            //送event
            function gTagEvent (category, action, label, value = 1){
                return new Promise(resolve => {
                    gtag('event', action, {
                        event_callback: resolve,
                        event_category: category,
                        event_label: label,
                        value,
                    })
                })
            }
            
            // 引用 LIFF SDK 的頁面，頁面中的 lang 值
            liff.getLanguage();
            
            // LIFF SDK 的版本
            liff.getVersion();
            
            // 回傳是否由 LINE App 存取
            liff.isInClient();
            
            // 取得使用者類型
            liff.getContext();
        });
        </script>
    </body>
</html>
